***** EXTRACT *****

In this use-case, we propose to use two different multilayer networks:

The third approach, Random Walk with Restart (RWR), is applied into two different networks compositions:

1. Multilayer network with three molecular layers + rare disease pathways network connected to nodes
2. Multilayer network with three molecular layers + disease-disease similarity network linked with a bipartite

The RWR is performed using multiXrank.



Running Random Walk analysis with data retrieved automatically from databases
--------------------------------------------------------------------------------

| To know how to create the rare disease pathways network: see :ref:`pathwaysOfInterestNet`.
| To know how to create the disease-disease similarity network: see :ref:`DDnet`.

Whatever the network used, we want to extract target genes of vitamin A and its descendant chemicals (``--directAssociation False``).
The **chemicalsFile.csv** file [:ref:`FORMAT <chemicalsFile>`] contains the MeSH ID of vitamin A.
Then, we keep vitamin-gene interaction with at least 2 associated publications (``--nbPub 2``).

MultiXrank needs a configuration file (``--configPath``) and the networks path (``--networksPath``). We run the analysis with
default parameters.

The target genes are set as seeds for the walk and saved into a file ``--seedsFile examples/InputData/seeds.txt``.
You need to give the SIF file name (``--sifFileName``) to save the top nodes based on the score calculated by the RWR (``--top 10``).

Results files are saved into ``useCases/OutputResults_useCase1/`` folder.

.. cssclass:: italic

    If you need more details about the input format files, see :ref:`GR` and :ref:`configFile` parts.

.. tip::

    Whatever the networks used, the **command line is the same**. But you have to **change** the network name inside the
    **configuration file**.

    .. tabs::

        .. group-tab:: Rare disease pathways network

            .. code-block:: bash
                :emphasize-lines: 9,11

                 multiplex:
                     1:
                         layers:
                             - multiplex/1/Complexes_Nov2020.gr
                             - multiplex/1/PPI_Jan2021.gr
                             - multiplex/1/Reactome_Nov2020.gr
                     2:
                         layers:
                             - multiplex/2/WP_RareDiseasesNetwork_fromRequest.sif
                 bipartite:
                     bipartite/Bipartite_WP_RareDiseases_geneSymbols_fromRequest.tsv:
                         source: 2
                         target: 1
                 seed:
                     seeds.txt

        .. group-tab:: Disease-Disease similarity network

            .. code-block:: bash
               :emphasize-lines: 9,11

                multiplex:
                    1:
                        layers:
                            - multiplex/1/Complexes_Nov2020.gr
                            - multiplex/1/PPI_Jan2021.gr
                            - multiplex/1/Reactome_Nov2020.gr
                    2:
                        layers:
                            - multiplex/2/DiseaseSimilarity_network_2022_06_11.txt
                bipartite:
                    bipartite/Bipartite_genes_to_OMIM_2022_09_27.txt:
                        source: 2
                        target: 1
                seed:
                    seeds.txt


.. code-block:: bash

    odamnet multixrank  --chemicalsFile useCases/InputData/chemicalsFile.csv \
                                --directAssociation FALSE \
                                --nbPub 2 \
                                --configPath useCases/InputData/config_minimal_useCase1.yml \
                                --networksPath useCases/InputData/ \
                                --seedsFile useCases/InputData/seeds.txt \
                                --sifFileName resultsNetwork_useCase1.sif \
                                --top 10 \
                                --outputPath useCases/OutputResults_useCase1/

Several files are generated:

- ``CTD_request_D014801_2022_09_07.tsv`` and ``CTD_requestFiltered_D014801_2022_09_07.tsv``:
  the first file contains **results from CTD** request and the second one contains the filtered (by publications number) results.

- ``RWR_D014801/`` folder with the walk results:

    - ``config_minimal_useCase1.yml`` and ``seeds.txt``: copies of the input files

    - ``multiplex_1.tsv`` and ``multiplex_2.tsv``: score for each feature. 1 corresponds to the multiplex network  and 2 to
      the rare disease pathways network (depends of the network folder name).

    - ``resultsNetwork_useCase1.sif``: SIF file name that contains the network result

.. cssclass:: italic

    For more details about these file, see :doc:`../formats/Output` page.


We use the default parameters, whatever the networks used.

*In this part, we present results found for the first multilayer network composition: multiplex network + rare disease pathways network.*

First, multiXrank uses target genes as *seeds* to start the walk. Over 1,988 target genes are used over 2,143 retrieved
target genes.

The gene with the highest score is ``VCAM1`` with ``score = 0.0002083975629882177`` (it's a seed). This score helps
us to select a list of pathways. All pathways with a score bigger than this score are extracted and considered as connected
with target genes (i.e. seeds).

According this highest score, **27 pathways** are selected (:ref:`Table 11 <useCase1_pathwaysRWR>`).

_useCase1_pathwaysRWR:
.. table:: Pathways linked to target genes
    :align: center

    +------------+-----------------------------------------------------+--------------+
    | node       | pathways                                            | score        |
    +============+=====================================================+==============+
    | WP5087     | Malignant pleural mesothelioma                      | 0.002871     |
    +------------+-----------------------------------------------------+--------------+
    | WP4673     | Male infertility                                    | 0.000868     |
    +------------+-----------------------------------------------------+--------------+
    | WP5124     | Alzheimer's disease                                 | 0.000775     |
    +------------+-----------------------------------------------------+--------------+
    | WP2059     | Alzheimer's disease and miRNA effects               | 0.000775     |
    +------------+-----------------------------------------------------+--------------+
    | WP4298     | Acute viral myocarditis                             | 0.000731     |
    +------------+-----------------------------------------------------+--------------+
    | WP4746     | Thyroid hormones production and peripheral ...      | 0.000622     |
    +------------+-----------------------------------------------------+--------------+
    | WP3584     | MECP2 and associated Rett syndrome                  | 0.000601     |
    +------------+-----------------------------------------------------+--------------+
    | WP5224     | 2q37 copy number variation syndrome                 | 0.000567     |
    +------------+-----------------------------------------------------+--------------+
    | WP4549     | Fragile X syndrome                                  | 0.000555     |
    +------------+-----------------------------------------------------+--------------+
    | WP4657     | 22q11.2 copy number variation syndrome              | 0.000522     |
    +------------+-----------------------------------------------------+--------------+
    | WP4541     | Hippo-Merlin signaling dysregulation                | 0.000521     |
    +------------+-----------------------------------------------------+--------------+
    | WP4932     | 7q11.23 copy number variation syndrome              | 0.000492     |
    +------------+-----------------------------------------------------+--------------+
    | **WP5053** | **Development of ureteric collection system**       | **0.000454** |
    +------------+-----------------------------------------------------+--------------+
    | WP4949     | 16p11.2 proximal deletion syndrome                  | 0.000442     |
    +------------+-----------------------------------------------------+--------------+
    | WP5114     | Nucleotide excision repair in xeroderma pigmentosum | 0.000394     |
    +------------+-----------------------------------------------------+--------------+
    | WP4312     | Rett syndrome causing genes                         | 0.000393     |
    +------------+-----------------------------------------------------+--------------+
    | WP2447     | Amyotrophic lateral sclerosis (ALS)                 | 0.000384     |
    +------------+-----------------------------------------------------+--------------+
    | WP4879     | Overlap between signal transduction pathways ...    | 0.000328     |
    +------------+-----------------------------------------------------+--------------+
    | WP4906     | 3q29 copy number variation syndrome                 | 0.000305     |
    +------------+-----------------------------------------------------+--------------+
    | WP4540     | Hippo signaling regulation pathways                 | 0.000303     |
    +------------+-----------------------------------------------------+--------------+
    | WP5222     | 2q13 copy number variation syndrome                 | 0.000284     |
    +------------+-----------------------------------------------------+--------------+
    | WP3995     | Prion disease pathway                               | 0.000280     |
    +------------+-----------------------------------------------------+--------------+
    | WP3998     | Prader-Willi and Angelman syndrome                  | 0.000247     |
    +------------+-----------------------------------------------------+--------------+
    | WP4803     | Ciliopathies                                        | 0.000244     |
    +------------+-----------------------------------------------------+--------------+
    | WP2371     | Parkinson's disease pathway                         | 0.000231     |
    +------------+-----------------------------------------------------+--------------+
    | **WP4823** | **Genes controlling nephrogenesis**                 | **0.000221** |
    +------------+-----------------------------------------------------+--------------+
    | WP4545     | Oxysterols derived from cholesterol                 | 0.000214     |
    +------------+-----------------------------------------------------+--------------+

Two pathways related to CAKUT disease are found: WP5053 and WP4823. You can visualise the results with a network as
shown on the :numref:`useCase1_orsum`.

_useCase1_pathwaysNetworkRWR:
.. figure:: ../../pictures/RWR_pathwaysNet_useCase1.png
   :alt: usecase 1 pathwaysNetworkRWR
   :align: center

   : Results from RWR through the multiplex network and rare disease pathways network

    Disease pathways are represented by triangle nodes in pink, genes are represented by white nodes and target genes by grey nodes.

awk -F"\t" 'NR==FNR{a[$1]; next} {if($1 in a){print $1"\t"$2}}' RWR_top20.txt ../../OutputOverlapResults/WP_RareDiseases_request_2022_09_07.gmt

awk -F"\t" 'NR==FNR{a[$1]; next} {if($1 in a){print $1"\t"$2}}' RWR_top20.txt ../../../../../DiseaseNetworks/hpo_disease_net/00_Data/phenotype_2022_06_11_diseaseNames.hpoa > diseasesDescription.txt

Networks available
--------------------

.. note::

    We use the multilayer network from multiXrank's paper [1]_.

We propose to run the RWR on two different multilayer networks:

- multilayer network with three molecular layers + pathways/processes of interest network (:numref:`RWRFig` - left part)
- multilayer network with three molecular layers + disease-disease similarity network (:numref:`RWRFig` - right part)

_RWRFig:
.. figure:: ../../pictures/NetworkAvailable_RWR.png
    :alt: RWR networks
    :align: center

    : Random Walk with Restart into two different network compositions

*multiXrank need network as input. So we create the pathways/processes of interest network, even if it's a disconnected*
*network (without link between nodes).*

Networks available
-----------------------------------

.. warning::

    Be careful when using networks: **gene IDs** format are not always consistent between networks, target genes and
    pathways/processes of interest.
    If data are extracted by request, target genes and genes in pathways/processes of interest are in **HGNC** format.

Protein-Protein Interaction (PPI) network
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

We provide a PPI network (from the Valdeolivas *et al.,* paper [4]_, November 2016). The gene name format is
**HGCN**. You can give it to the script using the required parameter ``-n, --networkFile``.

It contains 66,971 interactions (edges) and 12,621 genes (nodes). The following part gives you an overview of the file:

.. code-block::

    node_1	link	node_2
    AAMP	ppi	VPS52
    AAMP	ppi	BHLHE40
    AAMP	ppi	AEN
    AAMP	ppi	C8orf33
    AAMP	ppi	TK1


User-provided network
^^^^^^^^^^^^^^^^^^^^^^^^^^

.. caution::

    :octicon:`alert;2em;` gene IDs need to correspond with the target genes list and GMT files !!

You can use your own network. The network file has to be in :ref:`SIF format <SIF>` and you can give it to
the script using the required parameter ``-n, --networkFile``.


Networks from NDEx database
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. caution::

    :octicon:`alert;2em;sd-text-info` gene IDs need to correspond with the target genes list and GMT files !!

You can directly request `NDEx <https://www.ndexbio.org/#/>`_ [3]_ and extract the network that you want to use
(REST API [3]_:sup:`,` [5]_ :sup:`,` [6]_). You need to specify the network UUID using the optional parameter
``--netUUID``. The network will be save into a :ref:`SIF file <SIF>`.


.. note::

    | **Multilayer** is a network with several layers where layers contain different nodes types
    | **Multiplex** is a network with several layers (multilayer) where layers contain same type of nodes

The third approach implemented in ODAMNet is a Random Walk with Restart analysis (RWR). RWR is applied using
multiXrank [10]_ through a multilayer composed of genes and diseases nodes.

We applied RWR using two different multilayer compositions:

- **Multilayer 1**: Multiplex + pathways/processes related to CAKUT network
- **Multilayer 2**: Multiplex + disease-disease similarity network

Used multilayers will be detailed in corresponding section results.

.. cssclass:: italic

    For more details about RWR, see :doc:`../approaches/methods_RWR`.

Running Random Walk analysis with data provided by user
-----------------------------------------------------------

Target genes files is given using ``--targetGenesFile`` parameter. The file contains list of genes targeted by vitamin
A [:ref:`FORMAT <targetGenesFile>`].

To perform RWR, multiXrank [10]_ needs a configuration file given using ``--configPath`` parameter. This configuration
file contains path of different networks and target genes files used. The configuration file might contains parameters
for RWR analysis. We run the RWR analysis with default parameters.

MultiXrank needs also the networks directory path given using ``--networksPath`` parameter. MultiXrank defines target
genes as seeds for the walk. Target genes will be saved into a file given using ``--seedsFile`` parameter.

Two others parameters are required: number to select top nodes in each layer (``--top``) and file name to saved result
network which contains top nodes of each layers and their relationships (``--sifFileName``).

Results files are saved into ``useCases/OutputResults_useCase2/`` folder.







.. cssclass:: italic

    | For more details about the input files, see :ref:`GR` section.
    | For more details about the output files, see :doc:`../formats/Output` page.


By default, WikiPathays is automatically queried to retrieve rare disease pathways. Moreover, you can give your own
pathways/processes of interest (``--GMT``). You need to provided the ontology source of them too (``backgroundFile``).









.. tip::

   Theses parameters, ``--GMT`` and ``--backgroundFile`` can be used for reproducibility.


.. line-block::

        Two ways exist to retrieve the list of target genes:

        :ref:`chemicalsFile`: give chemical IDs file as input and query the Comparative Toxicogenomics Database (CTD)
        :ref:`targetGenesFile`: give your own target genes file

.. tip::

   For reproducibility, you can give your own version of CTD file using ``--CTD_file`` [:ref:`FORMAT <CTD_file>`]